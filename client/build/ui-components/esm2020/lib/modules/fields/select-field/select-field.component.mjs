import { Component, Input } from '@angular/core';
import { FormControl, NG_VALUE_ACCESSOR, } from '@angular/forms';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@angular/forms";
import * as i3 from "primeng/multiselect";
import * as i4 from "primeng/dropdown";
export class SelectFieldComponent {
    constructor() {
        this.isReadOnly = false;
        this.options = [];
        this.multiSelect = false;
        this.disabled = false;
        this.showClear = false;
        this.formControl = new FormControl(null);
        this.hasValue = false;
        this._componentDestroyed$ = new Subject();
        this.onChange = (value) => { };
        this.onTouched = () => { };
    }
    ngOnInit() {
        this.formControl.valueChanges
            .pipe(takeUntil(this._componentDestroyed$))
            .subscribe((value) => {
            this.displayValue = value;
            this.hasValue = Array.isArray(value) ? !!value.length : !!value;
            this.onChange(value);
        });
    }
    ngOnDestroy() {
        this._componentDestroyed$.next();
        this._componentDestroyed$.complete();
    }
    writeValue(value) {
        if (Array.isArray(value)) {
            // MultiSelect
            const fullOptions = value.map(id => this.getFullOptionFromId(id));
            this.formControl.setValue(fullOptions);
        }
        else {
            // Select
            const fullOption = this.getFullOptionFromId(value);
            this.formControl.setValue(fullOption);
        }
    }
    registerOnChange(fn) {
        this.onChange = (value) => {
            if (Array.isArray(value)) {
                const ids = value.map(option => this.getIdFromOption(option));
                fn(ids);
            }
            else {
                const id = this.getIdFromOption(value);
                fn(id);
            }
        };
    }
    // Busco en la lista de opciones la opción cuyo ID coincide con el que proporcionamos.
    // Si no encontramos una opción que coincida, retorno null.
    getFullOptionFromId(id) {
        return this.options.find(option => option.id === id) || null;
    }
    getIdFromOption(option) {
        return option ? option.id : null;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    setDisabledState(isDisabled) {
        isDisabled ? this._disableFormControl() : this._enableFormControl();
    }
    _enableFormControl() {
        this.formControl.enable({ emitEvent: false });
    }
    _disableFormControl() {
        this.formControl.disable({ emitEvent: false });
    }
}
SelectFieldComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: SelectFieldComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
SelectFieldComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: SelectFieldComponent, selector: "custom-select-field", inputs: { isReadOnly: ["readonly", "isReadOnly"], inputId: "inputId", options: "options", multiSelect: "multiSelect", disabled: "disabled", showClear: "showClear", placeholder: "placeholder" }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: SelectFieldComponent,
            multi: true,
        },
    ], ngImport: i0, template: "<ng-container *ngIf=\"!this.isReadOnly; else readOnlyTemplate\">\r\n  <p-multiSelect\r\n    *ngIf=\"this.multiSelect; else singleSelectTemplate\"\r\n    [options]=\"this.options\"\r\n    [formControl]=\"this.formControl\"\r\n    [defaultLabel]=\"this.placeholder || 'Seleccione una o multiples opciones'\"\r\n    dataKey=\"id\"\r\n    optionLabel=\"description\"\r\n    display=\"chip\"\r\n    [readonly]=\"this.isReadOnly\"\r\n    [inputId]=\"this.inputId\"\r\n    [disabled]=\"this.disabled\"\r\n    (onChange)=\"this.onTouched()\"\r\n    (onPanelHide)=\"this.onTouched()\"\r\n  >\r\n  </p-multiSelect>\r\n  <ng-template #singleSelectTemplate>\r\n    <p-dropdown\r\n      [options]=\"this.options\"\r\n      [formControl]=\"this.formControl\"\r\n      [showClear]=\"this.showClear\"\r\n      [placeholder]=\"this.placeholder || 'Seleccione una opci\u00F3n'\"\r\n      dataKey=\"id\"\r\n      optionLabel=\"description\"\r\n      [readonly]=\"this.isReadOnly\"\r\n      [inputId]=\"this.inputId\"\r\n      [disabled]=\"this.disabled\"\r\n      (onChange)=\"this.onTouched()\"\r\n      (onHide)=\"this.onTouched()\"\r\n    >\r\n    </p-dropdown>\r\n  </ng-template>\r\n</ng-container>\r\n\r\n<ng-template #readOnlyTemplate>\r\n  <div class=\"read-only-template\">\r\n    <ng-container *ngIf=\"this.multiSelect; else singleSelectTemplate\">\r\n      <ul\r\n        *ngIf=\"this.displayValue && this.displayValue.length; else emptyValueTemplate\"\r\n        class=\"read-only-template__list\"\r\n      >\r\n        <li\r\n          *ngFor=\"let value of displayValue\"\r\n          class=\"read-only-template__list--item\"\r\n        >\r\n          {{ value.description }}\r\n        </li>\r\n      </ul>\r\n    </ng-container>\r\n  </div>\r\n</ng-template>\r\n\r\n<ng-template #singleSelectTemplate>\r\n  <span\r\n    *ngIf=\"this.displayValue; else emptyValueTemplate\"\r\n    class=\"read-only-template__value\"\r\n    >{{ this.displayValue.description }}</span\r\n  >\r\n</ng-template>\r\n\r\n<ng-template #emptyValueTemplate>\r\n  <span class=\"read-only-template__value--empty\">-</span>\r\n</ng-template>\r\n", dependencies: [{ kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i2.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "component", type: i3.MultiSelect, selector: "p-multiSelect", inputs: ["style", "styleClass", "panelStyle", "panelStyleClass", "inputId", "disabled", "readonly", "group", "filter", "filterPlaceHolder", "filterLocale", "overlayVisible", "tabindex", "appendTo", "dataKey", "name", "label", "ariaLabelledBy", "displaySelectedLabel", "maxSelectedLabels", "selectionLimit", "selectedItemsLabel", "showToggleAll", "emptyFilterMessage", "emptyMessage", "resetFilterOnHide", "dropdownIcon", "optionLabel", "optionValue", "optionDisabled", "optionGroupLabel", "optionGroupChildren", "showHeader", "filterBy", "scrollHeight", "lazy", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "overlayOptions", "ariaFilterLabel", "filterMatchMode", "tooltip", "tooltipPosition", "tooltipPositionStyle", "tooltipStyleClass", "autofocusFilter", "display", "autocomplete", "showClear", "autoZIndex", "baseZIndex", "showTransitionOptions", "hideTransitionOptions", "defaultLabel", "placeholder", "options", "filterValue", "itemSize"], outputs: ["onChange", "onFilter", "onFocus", "onBlur", "onClick", "onClear", "onPanelShow", "onPanelHide", "onLazyLoad", "onRemove"] }, { kind: "component", type: i4.Dropdown, selector: "p-dropdown", inputs: ["scrollHeight", "filter", "name", "style", "panelStyle", "styleClass", "panelStyleClass", "readonly", "required", "editable", "appendTo", "tabindex", "placeholder", "filterPlaceholder", "filterLocale", "inputId", "selectId", "dataKey", "filterBy", "autofocus", "resetFilterOnHide", "dropdownIcon", "optionLabel", "optionValue", "optionDisabled", "optionGroupLabel", "optionGroupChildren", "autoDisplayFirst", "group", "showClear", "emptyFilterMessage", "emptyMessage", "lazy", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "overlayOptions", "ariaFilterLabel", "ariaLabel", "ariaLabelledBy", "filterMatchMode", "maxlength", "tooltip", "tooltipPosition", "tooltipPositionStyle", "tooltipStyleClass", "autofocusFilter", "overlayDirection", "disabled", "itemSize", "autoZIndex", "baseZIndex", "showTransitionOptions", "hideTransitionOptions", "options", "filterValue"], outputs: ["onChange", "onFilter", "onFocus", "onBlur", "onClick", "onShow", "onHide", "onClear", "onLazyLoad"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: SelectFieldComponent, decorators: [{
            type: Component,
            args: [{ selector: 'custom-select-field', providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: SelectFieldComponent,
                            multi: true,
                        },
                    ], template: "<ng-container *ngIf=\"!this.isReadOnly; else readOnlyTemplate\">\r\n  <p-multiSelect\r\n    *ngIf=\"this.multiSelect; else singleSelectTemplate\"\r\n    [options]=\"this.options\"\r\n    [formControl]=\"this.formControl\"\r\n    [defaultLabel]=\"this.placeholder || 'Seleccione una o multiples opciones'\"\r\n    dataKey=\"id\"\r\n    optionLabel=\"description\"\r\n    display=\"chip\"\r\n    [readonly]=\"this.isReadOnly\"\r\n    [inputId]=\"this.inputId\"\r\n    [disabled]=\"this.disabled\"\r\n    (onChange)=\"this.onTouched()\"\r\n    (onPanelHide)=\"this.onTouched()\"\r\n  >\r\n  </p-multiSelect>\r\n  <ng-template #singleSelectTemplate>\r\n    <p-dropdown\r\n      [options]=\"this.options\"\r\n      [formControl]=\"this.formControl\"\r\n      [showClear]=\"this.showClear\"\r\n      [placeholder]=\"this.placeholder || 'Seleccione una opci\u00F3n'\"\r\n      dataKey=\"id\"\r\n      optionLabel=\"description\"\r\n      [readonly]=\"this.isReadOnly\"\r\n      [inputId]=\"this.inputId\"\r\n      [disabled]=\"this.disabled\"\r\n      (onChange)=\"this.onTouched()\"\r\n      (onHide)=\"this.onTouched()\"\r\n    >\r\n    </p-dropdown>\r\n  </ng-template>\r\n</ng-container>\r\n\r\n<ng-template #readOnlyTemplate>\r\n  <div class=\"read-only-template\">\r\n    <ng-container *ngIf=\"this.multiSelect; else singleSelectTemplate\">\r\n      <ul\r\n        *ngIf=\"this.displayValue && this.displayValue.length; else emptyValueTemplate\"\r\n        class=\"read-only-template__list\"\r\n      >\r\n        <li\r\n          *ngFor=\"let value of displayValue\"\r\n          class=\"read-only-template__list--item\"\r\n        >\r\n          {{ value.description }}\r\n        </li>\r\n      </ul>\r\n    </ng-container>\r\n  </div>\r\n</ng-template>\r\n\r\n<ng-template #singleSelectTemplate>\r\n  <span\r\n    *ngIf=\"this.displayValue; else emptyValueTemplate\"\r\n    class=\"read-only-template__value\"\r\n    >{{ this.displayValue.description }}</span\r\n  >\r\n</ng-template>\r\n\r\n<ng-template #emptyValueTemplate>\r\n  <span class=\"read-only-template__value--empty\">-</span>\r\n</ng-template>\r\n" }]
        }], propDecorators: { isReadOnly: [{
                type: Input,
                args: ['readonly']
            }], inputId: [{
                type: Input
            }], options: [{
                type: Input
            }], multiSelect: [{
                type: Input
            }], disabled: [{
                type: Input
            }], showClear: [{
                type: Input
            }], placeholder: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWZpZWxkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpLWNvbXBvbmVudHMvc3JjL2xpYi9tb2R1bGVzL2ZpZWxkcy9zZWxlY3QtZmllbGQvc2VsZWN0LWZpZWxkLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpLWNvbXBvbmVudHMvc3JjL2xpYi9tb2R1bGVzL2ZpZWxkcy9zZWxlY3QtZmllbGQvc2VsZWN0LWZpZWxkLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUNwRSxPQUFPLEVBRUwsV0FBVyxFQUNYLGlCQUFpQixHQUNsQixNQUFNLGdCQUFnQixDQUFDO0FBRXhCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7QUFrQjNDLE1BQU0sT0FBTyxvQkFBb0I7SUFYakM7UUFjcUIsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUV0QyxZQUFPLEdBQWMsRUFBRSxDQUFDO1FBQ3hCLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsY0FBUyxHQUFHLEtBQUssQ0FBQTtRQUluQixnQkFBVyxHQUFHLElBQUksV0FBVyxDQUE2QixJQUFJLENBQUMsQ0FBQztRQUVoRSxhQUFRLEdBQVksS0FBSyxDQUFDO1FBRXpCLHlCQUFvQixHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFpQjVDLGFBQVEsR0FBRyxDQUFDLEtBQXlCLEVBQUUsRUFBRSxHQUFFLENBQUMsQ0FBQztRQUM3QyxjQUFTLEdBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDO0tBb0Q3QjtJQXBFQyxRQUFRO1FB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QUFXLENBQUMsT0FBTyxDQUFDLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDakQsQ0FBQzs7aUhBckZVLG9CQUFvQjtxR0FBcEIsb0JBQW9CLGdQQVJwQjtRQUNUO1lBQ0UsT0FBTyxFQUFFLGlCQUFpQjtZQUMxQixXQUFXLEVBQUUsb0JBQW9CO1lBQ2pDLEtBQUssRUFBRSxJQUFJO1NBQ1o7S0FDRiwwQkN4QkgsbWtFQStEQTsyRkRyQ2Esb0JBQW9CO2tCQVhoQyxTQUFTOytCQUNFLHFCQUFxQixhQUVwQjt3QkFDVDs0QkFDRSxPQUFPLEVBQUUsaUJBQWlCOzRCQUMxQixXQUFXLHNCQUFzQjs0QkFDakMsS0FBSyxFQUFFLElBQUk7eUJBQ1o7cUJBQ0Y7OEJBS2tCLFVBQVU7c0JBQTVCLEtBQUs7dUJBQUMsVUFBVTtnQkFDUixPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUVHLFdBQVc7c0JBQW5CLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1xyXG4gIENvbnRyb2xWYWx1ZUFjY2Vzc29yLFxyXG4gIEZvcm1Db250cm9sLFxyXG4gIE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJT3B0aW9uIHtcclxuICBpZDogYW55O1xyXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnY3VzdG9tLXNlbGVjdC1maWVsZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NlbGVjdC1maWVsZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICB7XHJcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICB1c2VFeGlzdGluZzogU2VsZWN0RmllbGRDb21wb25lbnQsXHJcbiAgICAgIG11bHRpOiB0cnVlLFxyXG4gICAgfSxcclxuICBdLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2VsZWN0RmllbGRDb21wb25lbnRcclxuICBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBDb250cm9sVmFsdWVBY2Nlc3NvclxyXG57XHJcbiAgQElucHV0KCdyZWFkb25seScpIGlzUmVhZE9ubHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBASW5wdXQoKSBpbnB1dElkITogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIG9wdGlvbnM6IElPcHRpb25bXSA9IFtdO1xyXG4gIEBJbnB1dCgpIG11bHRpU2VsZWN0ID0gZmFsc2U7XHJcbiAgQElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcclxuICBASW5wdXQoKSBzaG93Q2xlYXIgPSBmYWxzZVxyXG5cclxuICBASW5wdXQoKSBwbGFjZWhvbGRlciAhOiBzdHJpbmc7XHJcbiAgXHJcbiAgcHVibGljIGZvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sPElPcHRpb24gfCBJT3B0aW9uW10gfCBudWxsPihudWxsKTtcclxuICBwdWJsaWMgZGlzcGxheVZhbHVlOiBhbnk7XHJcbiAgcHVibGljIGhhc1ZhbHVlOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIHByaXZhdGUgX2NvbXBvbmVudERlc3Ryb3llZCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZm9ybUNvbnRyb2wudmFsdWVDaGFuZ2VzXHJcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9jb21wb25lbnREZXN0cm95ZWQkKSlcclxuICAgICAgLnN1YnNjcmliZSgodmFsdWUpID0+IHtcclxuICAgICAgICB0aGlzLmRpc3BsYXlWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMuaGFzVmFsdWUgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/ICEhdmFsdWUubGVuZ3RoIDogISF2YWx1ZTtcclxuICAgICAgICB0aGlzLm9uQ2hhbmdlKHZhbHVlKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuX2NvbXBvbmVudERlc3Ryb3llZCQubmV4dCgpO1xyXG4gICAgdGhpcy5fY29tcG9uZW50RGVzdHJveWVkJC5jb21wbGV0ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uQ2hhbmdlID0gKHZhbHVlOiBhbnkgfCBhbnlbXSB8IG51bGwpID0+IHt9O1xyXG4gIHB1YmxpYyBvblRvdWNoZWQgPSAoKSA9PiB7fTtcclxuICBcclxuICBcclxuICBwdWJsaWMgd3JpdGVWYWx1ZSh2YWx1ZTogYW55IHwgYW55W10pOiB2b2lkIHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAvLyBNdWx0aVNlbGVjdFxyXG4gICAgICBjb25zdCBmdWxsT3B0aW9ucyA9IHZhbHVlLm1hcChpZCA9PiB0aGlzLmdldEZ1bGxPcHRpb25Gcm9tSWQoaWQpKTtcclxuICAgICAgdGhpcy5mb3JtQ29udHJvbC5zZXRWYWx1ZShmdWxsT3B0aW9ucyBhcyBJT3B0aW9uW10pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gU2VsZWN0XHJcbiAgICAgIGNvbnN0IGZ1bGxPcHRpb24gPSB0aGlzLmdldEZ1bGxPcHRpb25Gcm9tSWQodmFsdWUpO1xyXG4gICAgICB0aGlzLmZvcm1Db250cm9sLnNldFZhbHVlKGZ1bGxPcHRpb24pO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBwdWJsaWMgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlID0gKHZhbHVlOiBJT3B0aW9uIHwgSU9wdGlvbltdIHwgbnVsbCkgPT4ge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICBjb25zdCBpZHMgPSB2YWx1ZS5tYXAob3B0aW9uID0+IHRoaXMuZ2V0SWRGcm9tT3B0aW9uKG9wdGlvbikpO1xyXG4gICAgICAgIGZuKGlkcyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLmdldElkRnJvbU9wdGlvbih2YWx1ZSEpO1xyXG4gICAgICAgIGZuKGlkKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcbiAgXHJcbiAgLy8gQnVzY28gZW4gbGEgbGlzdGEgZGUgb3BjaW9uZXMgbGEgb3BjacOzbiBjdXlvIElEIGNvaW5jaWRlIGNvbiBlbCBxdWUgcHJvcG9yY2lvbmFtb3MuXHJcbiAgLy8gU2kgbm8gZW5jb250cmFtb3MgdW5hIG9wY2nDs24gcXVlIGNvaW5jaWRhLCByZXRvcm5vIG51bGwuXHJcbiAgcHJpdmF0ZSBnZXRGdWxsT3B0aW9uRnJvbUlkKGlkOiBhbnkpOiBJT3B0aW9uIHwgbnVsbHtcclxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZmluZChvcHRpb24gPT4gb3B0aW9uLmlkID09PSBpZCkgfHwgbnVsbDtcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSBnZXRJZEZyb21PcHRpb24ob3B0aW9uOiBJT3B0aW9uKTogYW55IHtcclxuICAgIHJldHVybiBvcHRpb24gPyBvcHRpb24uaWQgOiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0RGlzYWJsZWRTdGF0ZT8oaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgaXNEaXNhYmxlZCA/IHRoaXMuX2Rpc2FibGVGb3JtQ29udHJvbCgpIDogdGhpcy5fZW5hYmxlRm9ybUNvbnRyb2woKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX2VuYWJsZUZvcm1Db250cm9sKCk6IHZvaWQge1xyXG4gICAgdGhpcy5mb3JtQ29udHJvbC5lbmFibGUoeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfZGlzYWJsZUZvcm1Db250cm9sKCk6IHZvaWQge1xyXG4gICAgdGhpcy5mb3JtQ29udHJvbC5kaXNhYmxlKHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcclxuICB9XHJcbn1cclxuIiwiPG5nLWNvbnRhaW5lciAqbmdJZj1cIiF0aGlzLmlzUmVhZE9ubHk7IGVsc2UgcmVhZE9ubHlUZW1wbGF0ZVwiPlxyXG4gIDxwLW11bHRpU2VsZWN0XHJcbiAgICAqbmdJZj1cInRoaXMubXVsdGlTZWxlY3Q7IGVsc2Ugc2luZ2xlU2VsZWN0VGVtcGxhdGVcIlxyXG4gICAgW29wdGlvbnNdPVwidGhpcy5vcHRpb25zXCJcclxuICAgIFtmb3JtQ29udHJvbF09XCJ0aGlzLmZvcm1Db250cm9sXCJcclxuICAgIFtkZWZhdWx0TGFiZWxdPVwidGhpcy5wbGFjZWhvbGRlciB8fCAnU2VsZWNjaW9uZSB1bmEgbyBtdWx0aXBsZXMgb3BjaW9uZXMnXCJcclxuICAgIGRhdGFLZXk9XCJpZFwiXHJcbiAgICBvcHRpb25MYWJlbD1cImRlc2NyaXB0aW9uXCJcclxuICAgIGRpc3BsYXk9XCJjaGlwXCJcclxuICAgIFtyZWFkb25seV09XCJ0aGlzLmlzUmVhZE9ubHlcIlxyXG4gICAgW2lucHV0SWRdPVwidGhpcy5pbnB1dElkXCJcclxuICAgIFtkaXNhYmxlZF09XCJ0aGlzLmRpc2FibGVkXCJcclxuICAgIChvbkNoYW5nZSk9XCJ0aGlzLm9uVG91Y2hlZCgpXCJcclxuICAgIChvblBhbmVsSGlkZSk9XCJ0aGlzLm9uVG91Y2hlZCgpXCJcclxuICA+XHJcbiAgPC9wLW11bHRpU2VsZWN0PlxyXG4gIDxuZy10ZW1wbGF0ZSAjc2luZ2xlU2VsZWN0VGVtcGxhdGU+XHJcbiAgICA8cC1kcm9wZG93blxyXG4gICAgICBbb3B0aW9uc109XCJ0aGlzLm9wdGlvbnNcIlxyXG4gICAgICBbZm9ybUNvbnRyb2xdPVwidGhpcy5mb3JtQ29udHJvbFwiXHJcbiAgICAgIFtzaG93Q2xlYXJdPVwidGhpcy5zaG93Q2xlYXJcIlxyXG4gICAgICBbcGxhY2Vob2xkZXJdPVwidGhpcy5wbGFjZWhvbGRlciB8fCAnU2VsZWNjaW9uZSB1bmEgb3BjacOzbidcIlxyXG4gICAgICBkYXRhS2V5PVwiaWRcIlxyXG4gICAgICBvcHRpb25MYWJlbD1cImRlc2NyaXB0aW9uXCJcclxuICAgICAgW3JlYWRvbmx5XT1cInRoaXMuaXNSZWFkT25seVwiXHJcbiAgICAgIFtpbnB1dElkXT1cInRoaXMuaW5wdXRJZFwiXHJcbiAgICAgIFtkaXNhYmxlZF09XCJ0aGlzLmRpc2FibGVkXCJcclxuICAgICAgKG9uQ2hhbmdlKT1cInRoaXMub25Ub3VjaGVkKClcIlxyXG4gICAgICAob25IaWRlKT1cInRoaXMub25Ub3VjaGVkKClcIlxyXG4gICAgPlxyXG4gICAgPC9wLWRyb3Bkb3duPlxyXG4gIDwvbmctdGVtcGxhdGU+XHJcbjwvbmctY29udGFpbmVyPlxyXG5cclxuPG5nLXRlbXBsYXRlICNyZWFkT25seVRlbXBsYXRlPlxyXG4gIDxkaXYgY2xhc3M9XCJyZWFkLW9ubHktdGVtcGxhdGVcIj5cclxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJ0aGlzLm11bHRpU2VsZWN0OyBlbHNlIHNpbmdsZVNlbGVjdFRlbXBsYXRlXCI+XHJcbiAgICAgIDx1bFxyXG4gICAgICAgICpuZ0lmPVwidGhpcy5kaXNwbGF5VmFsdWUgJiYgdGhpcy5kaXNwbGF5VmFsdWUubGVuZ3RoOyBlbHNlIGVtcHR5VmFsdWVUZW1wbGF0ZVwiXHJcbiAgICAgICAgY2xhc3M9XCJyZWFkLW9ubHktdGVtcGxhdGVfX2xpc3RcIlxyXG4gICAgICA+XHJcbiAgICAgICAgPGxpXHJcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgdmFsdWUgb2YgZGlzcGxheVZhbHVlXCJcclxuICAgICAgICAgIGNsYXNzPVwicmVhZC1vbmx5LXRlbXBsYXRlX19saXN0LS1pdGVtXCJcclxuICAgICAgICA+XHJcbiAgICAgICAgICB7eyB2YWx1ZS5kZXNjcmlwdGlvbiB9fVxyXG4gICAgICAgIDwvbGk+XHJcbiAgICAgIDwvdWw+XHJcbiAgICA8L25nLWNvbnRhaW5lcj5cclxuICA8L2Rpdj5cclxuPC9uZy10ZW1wbGF0ZT5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjc2luZ2xlU2VsZWN0VGVtcGxhdGU+XHJcbiAgPHNwYW5cclxuICAgICpuZ0lmPVwidGhpcy5kaXNwbGF5VmFsdWU7IGVsc2UgZW1wdHlWYWx1ZVRlbXBsYXRlXCJcclxuICAgIGNsYXNzPVwicmVhZC1vbmx5LXRlbXBsYXRlX192YWx1ZVwiXHJcbiAgICA+e3sgdGhpcy5kaXNwbGF5VmFsdWUuZGVzY3JpcHRpb24gfX08L3NwYW5cclxuICA+XHJcbjwvbmctdGVtcGxhdGU+XHJcblxyXG48bmctdGVtcGxhdGUgI2VtcHR5VmFsdWVUZW1wbGF0ZT5cclxuICA8c3BhbiBjbGFzcz1cInJlYWQtb25seS10ZW1wbGF0ZV9fdmFsdWUtLWVtcHR5XCI+LTwvc3Bhbj5cclxuPC9uZy10ZW1wbGF0ZT5cclxuIl19